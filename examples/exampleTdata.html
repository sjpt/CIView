<!doctype html>
<!--
    This illustrates the use of TData style data loading.
-->
<html>
	<head>
		<style>
		    .civ-icon{
		    	font-size:18px;
		    	cursor:pointer;
		    	margin:1px 4px;
		    }
		</style>
  		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
          <link rel="stylesheet" type="text/css" href="../css/jquery-ui-bootstrap/jquery-ui-1.10.3.custom.css">
         <link rel="stylesheet" type="text/css" href="../css/slickgrid/slick.grid.css">
         <link rel="stylesheet" type="text/css" href="../css/slickgrid/slick.default.theme.css">
         <link rel="stylesheet" type="text/css" href="../css/fa-5.5.0/all.css">
         <link rel="stylesheet" type="text/css" href="../css/dc.min.css">
         <link rel="stylesheet" type="text/css" href="../css/gridstack.css">
         <link rel="stylesheet" type="text/css" href="../css/ciview.css">
 
	</head>


 	<body>
		<h2 style= "display:inline-block;margin-bottom:4px"> Basic Setup </h2>
		<a href="https://github.com/Hughes-Genome-Group/CIView/blob/master/examples/example1.html">View Source</a>
		<div style="width:100%;margin-bottom:10px"> 
            Showing FIFA data from kaggle
		</div>

		<!-- The div to hold the panel -->
		
   	 	<div id="panel" style="height:500px;padding:10px" > </div>
   	 
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> 
        <!-- <script src="../src/vendor/jquery.min.js"></script> -->
		<script src="../src/vendor/jquery-ui.min.js"></script>
		<script src="../src/vendor/jquery-ui-fixes.js"></script>

		
		<!-- only necessary for browsers which do not support es6-->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser-polyfill.min.js"></script>
		<!-- contains all the js and css necessary for the browser-->


        <!-- http://localhost:8800/,,/CIView-master/examples/example1S.html -->
   	 	<script src="../src/ciview.js" type="module"></script>

		<script type="module">
            import {FilterPanel} from "../src/graphs.js";
            import {} from "../src/xyz_scatter_plot.js";
            import {} from "../src/density_scatter_plot.js";
			let loc = 'http://localhost:8800/,,/xyz/';
			// loc = '../..xyz/';
            import {init, awaitGGLoaded} from '../../xyz/patchxyz.js';
            init(loc);

			let testyaml = "../examples/data/fromMLV.yaml";
            testyaml = ',,/,,/,,/,,/BigPointData/cytof/cytof_1.5million_anonymised.txt.yaml'

			async function setUp(ydata){
                await awaitGGLoaded();

                window.tdata = new GG.tdata.TData(ydata, testyaml);
                window.data = tdata.makeProxy();
                await tdata.lazyLoadCol('id');

			    var columns=[
					{field:"X",name:"X",datatype:"double",filterable:true,sortable:true},
					{field:"Y",name:"Y",datatype:"double",filterable:true,sortable:true},
					{field:"Z",name:"Z",datatype:"double",filterable:true,sortable:true},
					{field:"cd3",name:"cd3",datatype:"double",filterable:true,sortable:true},
					{field:"cd4",name:"cd4",datatype:"double",filterable:true,sortable:true},
					{field:"cd8",name:"cd8",datatype:"double",filterable:true,sortable:true},
				];

				window.fp = new FilterPanel("panel",data,{menu_bar:true,columns:columns});
				async function addChart(x) {
                    // make sure all the data it needs will be ready
                    // in future, we could allow charts that accepted the incremental nature of lazyload
                    let p = x.param;
                    if (typeof p === 'string') p = [p];
                    const pp = [];
                    for (const k of p) {
                        pp.push(tdata.lazyLoadCol(k));
                    }
                    await Promise.all(pp);

					fp.addChart(x);
				}

                // note: as addChart is async these may get done in arbitrary order
                // depending how quickly the different columns get lazy loaded.
                // to enforce a required order, use 'await addChart'
                addChart({
					title:"xyz_scatter_plot",
					type:"xyz_scatter_plot",
					param:["height","weight","value", "foot"],
                    data: tdata // later ? ndx could know
				});
                
				addChart({
					title:"wgl_scatter_plot",
					type:"wgl_scatter_plot",
					param:["height","weight"]
				});

				addChart({
					title:"density_scatter_plot",
					type:"density_scatter_plot",
					param:["height","weight"],
				});

		
				addChart({
					type:"bar_chart",
					param:"overall",
					title:"Overall Score"
				});

				addChart({
					type:"bar_chart",
					param:"value",
					title:"Value(M)",
					display_max:20,
					bin_number:20
				});


				addChart({
					type:"box_plot",
					param:["foot","overall"],
					title:"Preferred Foot vs. Skill"
				});

				addChart({
					type:"row_chart",
					param:"position",
					cap:15
				})
	
				panel.style.height = '';
			
			}

			//load the data (take from https://www.kaggle.com/)
            $.ajax({
                url:testyaml
            }).done(setUp);
		</script>
 	 </body>
</html>